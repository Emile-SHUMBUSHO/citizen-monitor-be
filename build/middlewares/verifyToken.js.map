{"version":3,"file":"verifyToken.js","names":["req","res","next","authHeader","get","status","json","message","token","split","UNAUTHORIZED","errors","authentication","decodedToken","helper","decode","error","include","model","db","Profile","as","attributes","exclude","FindOne","id","user","password","body","userId","ACCESS_DENIED"],"sources":["../../src/middlewares/verifyToken.js"],"sourcesContent":["import status from '../config/status';\nimport * as helper from '../helpers';\nimport db from '../database/models';\nimport { FindOne } from '../database/queries';\n\nexport default async (req, res, next) => {\n  const authHeader = req.get('Authorization');\n  if (!authHeader) {\n    return res.status(403).json({ message: 'No token provided!' });\n  }\n  const token = authHeader.split(' ')[1];\n\n  if (!token) {\n    return res\n      .status(status.UNAUTHORIZED)\n      .json({ errors: { authentication: 'Please, login first.' } });\n  }\n\n  const decodedToken = helper.token.decode(token);\n  \n  if (decodedToken.errors || !decodedToken) {\n    return res\n      .status(status.UNAUTHORIZED)\n      .json({ error: 'Sorry, we fail to authenticate you.' });\n  }\n  const include = [\n    {\n      model: db.Profile,\n      as: 'user',\n      attributes: { exclude: ['createdAt', 'updatedAt'] },\n    },\n  ];\n  const user = await FindOne('User', { id: decodedToken.id }, include);\n  if (user && user) {\n    delete user.password;\n    req.user = user.get();\n    req.body.userId = req.user.id;\n  } else {\n    return res\n      .status(status.ACCESS_DENIED)\n      .json({ error: 'Sorry, we fail to authenticate you.' });\n  }\n  return next();\n};\n"],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AAA8C;AAAA;AAAA;EAAA,yFAE/B,iBAAOA,GAAG,EAAEC,GAAG,EAAEC,IAAI;IAAA;IAAA;MAAA;QAAA;UAAA;YAC5BC,UAAU,GAAGH,GAAG,CAACI,GAAG,CAAC,eAAe,CAAC;YAAA,IACtCD,UAAU;cAAA;cAAA;YAAA;YAAA,iCACNF,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;cAAEC,OAAO,EAAE;YAAqB,CAAC,CAAC;UAAA;YAE1DC,KAAK,GAAGL,UAAU,CAACM,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAAA,IAEjCD,KAAK;cAAA;cAAA;YAAA;YAAA,iCACDP,GAAG,CACPI,MAAM,CAACA,kBAAM,CAACK,YAAY,CAAC,CAC3BJ,IAAI,CAAC;cAAEK,MAAM,EAAE;gBAAEC,cAAc,EAAE;cAAuB;YAAE,CAAC,CAAC;UAAA;YAG3DC,YAAY,GAAGC,MAAM,CAACN,KAAK,CAACO,MAAM,CAACP,KAAK,CAAC;YAAA,MAE3CK,YAAY,CAACF,MAAM,IAAI,CAACE,YAAY;cAAA;cAAA;YAAA;YAAA,iCAC/BZ,GAAG,CACPI,MAAM,CAACA,kBAAM,CAACK,YAAY,CAAC,CAC3BJ,IAAI,CAAC;cAAEU,KAAK,EAAE;YAAsC,CAAC,CAAC;UAAA;YAErDC,OAAO,GAAG,CACd;cACEC,KAAK,EAAEC,kBAAE,CAACC,OAAO;cACjBC,EAAE,EAAE,MAAM;cACVC,UAAU,EAAE;gBAAEC,OAAO,EAAE,CAAC,WAAW,EAAE,WAAW;cAAE;YACpD,CAAC,CACF;YAAA;YAAA,OACkB,IAAAC,gBAAO,EAAC,MAAM,EAAE;cAAEC,EAAE,EAAEZ,YAAY,CAACY;YAAG,CAAC,EAAER,OAAO,CAAC;UAAA;YAA9DS,IAAI;YAAA,MACNA,IAAI,IAAIA,IAAI;cAAA;cAAA;YAAA;YACd,OAAOA,IAAI,CAACC,QAAQ;YACpB3B,GAAG,CAAC0B,IAAI,GAAGA,IAAI,CAACtB,GAAG,EAAE;YACrBJ,GAAG,CAAC4B,IAAI,CAACC,MAAM,GAAG7B,GAAG,CAAC0B,IAAI,CAACD,EAAE;YAAC;YAAA;UAAA;YAAA,iCAEvBxB,GAAG,CACPI,MAAM,CAACA,kBAAM,CAACyB,aAAa,CAAC,CAC5BxB,IAAI,CAAC;cAAEU,KAAK,EAAE;YAAsC,CAAC,CAAC;UAAA;YAAA,iCAEpDd,IAAI,EAAE;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CACd;EAAA;IAAA;EAAA;AAAA;AAAA"}